<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>あにあめもりあ | (名前)</title>
    <!-- ↑ TODO: 名前を変更してください -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;600;700;900&family=Zen+Old+Mincho:wght@400;600;700;900&display=swap"
        rel="stylesheet">
    <link rel="icon" href="../assets/favicon/multi_favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="../css/styles.css" />
</head>

<body>
    <a class="skip-link" href="#main">本文へスキップ</a>

    <div id="header-placeholder"></div>


    <main id="main">
        <section class="section">
            <div class="container">
                <div class="profile-layout-grid">
                    <!-- 1. Visual Area -->
                    <div class="reveal profile-visual-area">
                        <div class="cheki-visual"
                            style="border-radius: 12px; box-shadow: var(--shadow-strong); position: relative; overflow: visible;">
                            <!-- Background Image (Table Texture) -->
                            <div class="profile-bg-texture" style="
                                position: absolute;
                                inset: 0;
                                background-image: url('../assets/aniamemoria_table_D_1tai1.png');
                                background-size: 100% 100%;
                                background-position: center;
                                border-radius: 12px;
                                z-index: 0;
                            "></div>

                            <!-- Profile Switcher (Images) -->
                            <div class="profile-switcher-container" data-member-id="INSERT_ID_HERE"
                                style="position: absolute; inset: 0; z-index: 1;">
                                <!-- TODO: data-member-id を変更するか、下のscriptでID指定してください -->
                            </div>

                            <!-- Signature (Top Right) -->
                            <img src="" id="profile-sign-img" class="profile-sign" alt="Signature" style="
                                position: absolute;
                                top: 20px;
                                right: -20px;
                                width: 140px;
                                z-index: 2;
                                transform: rotate(10deg);
                                display: none; /* Show when loaded */
                            ">
                        </div>
                    </div>

                    <!-- 2. Text Area -->
                    <div class="reveal profile-text-area">
                        <div id="dynamic-tags-container" style="margin-bottom: 2px;">
                            <!-- Dynamic Tags -->
                        </div>
                        <div style="padding-left: 0.5em;">
                            <h1
                                style="font-size: 2.5rem; font-weight: 900; margin-bottom: 0px; margin-top: 0px; font-family: 'Zen Old Mincho', serif;">
                                名前</h1>

                            <!-- Block 1: Intro with Parchment Frame -->
                            <div class="parchment-frame">
                                <h3 style="margin-top: 0; font-weight: 900;">自己紹介</h3>
                                <p id="dynamic-intro-text">読み込み中...</p>
                                <img src="../assets/aniamemoria_logo.png" class="watermark-logo" alt="">
                            </div>

                            <!-- Block 2: Goals Section (Dynamic) -->
                            <div class="goals-section">
                                <h3 class="goals-title">目標</h3>
                                <div id="dynamic-goals-container">
                                    <!-- Goals will be injected here -->
                                    <div class="goals-text">読み込み中...</div>
                                </div>
                            </div>

                            <!-- Block 3: Social Icons -->
                            <div class="social-icons-container" id="dynamic-socials-container">
                                <!-- Dynamically loaded from site_data.js -->
                            </div>


                            <div style="text-align: center; margin-bottom: 20px;">
                                <a href="../pages/people.html" class="btn btn--ghost btn--sm">一覧に戻る</a>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Related Area -->
                    <div class="reveal profile-related-area">
                        <div class="related-cast">
                            <div class="related-label">関連キャスト</div>
                            <div class="related-slots" id="dynamic-related-cast">
                                <!-- Dynamically loaded -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>
    <script src="../_config/site_data.js"></script>
    <script src="../js/common-layout.js"></script>
    <script>
        renderLayout('../');
    </script>


    <script src="../js/script.js"></script>
    <script src="../js/profile_switcher.js"></script>
    <script>
        // Dynamic Profile Data Loader
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof membersData !== 'undefined') {
                const memberId = 'INSERT_ID_HERE'; // TODO: ここをメンバーIDに変更してください
                const member = membersData.find(m => m.id === memberId);

                // Update H1 Name if found (Optional, mostly static HTML is overwritten but good practice)
                if (member) {
                    const h1Title = document.querySelector('h1');
                    if (h1Title) h1Title.textContent = member.name;
                }

                if (member) {
                    // -1. Tags
                    const tagsContainer = document.getElementById('dynamic-tags-container');
                    if (tagsContainer) {
                        let tagsHtml = '';
                        // 1. Tag Label (Black)
                        if (member.tagLabel) {
                            tagsHtml += `<span class="tag" style="background:#000; color:#fff;">${member.tagLabel}</span>`;
                        }
                        // 2. Tags (Soft)
                        if (member.tags) {
                            const tagsList = member.tags.split(' ');
                            tagsList.forEach(t => {
                                // Filter out duplication if tagLabel exists
                                if (t !== member.tagLabel) {
                                    tagsHtml += `<span class="tag tag--soft">${t}</span>`;
                                }
                            });
                        }
                        tagsContainer.innerHTML = tagsHtml;
                    }

                    // 0. Introduction
                    if (member.introduction) {
                        const introEl = document.getElementById('dynamic-intro-text');
                        if (introEl) {
                            introEl.innerHTML = member.introduction;
                        }
                    }

                    // 1. Goals
                    const goalsSection = document.querySelector('.goals-section');
                    if (member.goals && Array.isArray(member.goals) && member.goals.length > 0) {
                        if (goalsSection) goalsSection.style.display = 'block';
                        const goalsContainer = document.getElementById('dynamic-goals-container');
                        if (goalsContainer) {
                            let html = '';
                            member.goals.forEach(goal => {
                                html += `<div class="goals-text" style="margin-bottom:8px;">${goal}</div>`;
                            });
                            goalsContainer.innerHTML = html;
                        }
                    } else {
                        if (goalsSection) goalsSection.style.display = 'none';
                    }

                    // 2. Sign
                    if (member.sign) {
                        const signImg = document.getElementById('profile-sign-img');
                        if (signImg) {
                            // Fix path if needed (simple check)
                            let path = member.sign;
                            if (!path.startsWith('http') && !path.startsWith('../') && !path.startsWith('/')) {
                                path = '../' + path;
                            }
                            signImg.src = path;
                            signImg.style.display = 'block';
                        }
                    }

                    // 2.5 Social Icons (Dynamic)
                    if (member.socials && Array.isArray(member.socials)) {
                        const socialContainer = document.getElementById('dynamic-socials-container');
                        if (socialContainer) {
                            let html = '';
                            member.socials.forEach(s => {
                                const type = s.type.toLowerCase();
                                const url = s.url;
                                let iconHtml = '';
                                let colorClass = 'social-icon--brown'; // Default color

                                // Icon Map
                                if (type === 'youtube') {
                                    colorClass = 'social-icon--red'; // Need to add red style or use inline
                                    iconHtml = '<svg viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>';
                                } else if (type === 'twitter') {
                                    colorClass = 'social-icon--blue';
                                    iconHtml = '<svg viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>';
                                } else if (type === 'x') {
                                    colorClass = 'social-icon--black'; // Need black style
                                    iconHtml = '<svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>';
                                } else if (type === 'facebook') {
                                    colorClass = 'social-icon--blue';
                                    iconHtml = '<svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.791-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>';
                                } else if (type === 'vrchat') {
                                    colorClass = 'social-icon--dark'; // VRChat specific
                                    iconHtml = '<img src="../assets/VRChat Logo Black.png" alt="VRChat" style="width: 50px; height: 50x; object-fit: contain;">';
                                } else if (type === 'booth') {
                                    colorClass = 'social-icon--red';
                                    iconHtml = '<img src="../assets/Booth_logo_icon.svg" alt="Booth" style="width: 45px; height: 45px; object-fit: contain;">';
                                } else {
                                    // Chain/Link icon for other platforms
                                    iconHtml = '<svg viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>';
                                }

                                // Inline style override for specific colors if class not defined
                                let style = '';
                                if (type === 'youtube') style = 'background-color: #FF0000; border-color: #FF0000; color: white;';
                                if (type === 'x') style = 'background-color: #000000; border-color: #000000; color: white;';
                                if (type === 'vrchat') style = 'background-color: #ffffff; border-color: #ccc;'; // White bg for black logo

                                html += `<a href="${url}" class="social-icon ${colorClass}" target="_blank" aria-label="${type}" style="${style}">
                                    ${iconHtml}
                                </a>`;
                            });
                            socialContainer.innerHTML = html;
                        }
                    }

                    // 3. Related Cast (Hybrid: Manual > Auto)
                    const relatedContainer = document.getElementById('dynamic-related-cast');
                    if (relatedContainer) {

                        // --- Helper: Get Related Members ---
                        const getRelatedMembers = (currentMember, allMembers) => {
                            // 1. Manual Priority
                            let results = [];
                            if (currentMember.related && Array.isArray(currentMember.related)) {
                                currentMember.related.forEach(rid => {
                                    const m = allMembers.find(mem => mem.id === rid);
                                    if (m) results.push(m);
                                });
                            }

                            // 2. Auto Fill (if needed)
                            if (results.length < 5) {
                                // Filter candidates: Not self, and not already in results
                                let candidates = allMembers.filter(m =>
                                    m.id !== currentMember.id &&
                                    !results.some(r => r.id === m.id)
                                );

                                // Prepare current member tags
                                const currentTags = currentMember.tags ? currentMember.tags.split(' ') : [];

                                // Score candidates
                                candidates = candidates.map(c => {
                                    let score = 0;
                                    // Tag Overlap (+10 per tag)
                                    if (c.tags) {
                                        const cTags = c.tags.split(' ');
                                        const overlap = cTags.filter(t => currentTags.includes(t)).length;
                                        score += overlap * 10;
                                    }
                                    // Section Match (+5)
                                    if (c.section === currentMember.section) {
                                        score += 5;
                                    }
                                    return { member: c, score: score };
                                });

                                // Sort by Score DESC
                                candidates.sort((a, b) => b.score - a.score);

                                // Fill remaining slots
                                for (let i = 0; i < candidates.length; i++) {
                                    if (results.length >= 5) break;
                                    results.push(candidates[i].member);
                                }
                            }
                            return results;
                        };

                        const relatedMembers = getRelatedMembers(member, membersData);

                        // Render
                        let html = '';
                        relatedMembers.forEach(relatedMember => {
                            // Fix path for image and link
                            let imgPath = relatedMember.profileImages && relatedMember.profileImages.length > 0
                                ? relatedMember.profileImages[0]
                                : relatedMember.image;

                            if (!imgPath.startsWith('http') && !imgPath.startsWith('../') && !imgPath.startsWith('/')) {
                                imgPath = '../' + imgPath;
                            }

                            let linkPath = relatedMember.link;
                            if (!linkPath.startsWith('http') && !linkPath.startsWith('../') && !linkPath.startsWith('/')) {
                                if (linkPath.includes('member/')) {
                                    linkPath = linkPath.split('member/')[1];
                                }
                            }

                            html += `
                                <a href="${linkPath}" class="cast-slot" title="${relatedMember.name}">
                                    <img src="${imgPath}" alt="${relatedMember.name}">
                                </a>
                            `;
                        });
                        relatedContainer.innerHTML = html;
                    }
                }
            }
        });
    </script>

</body>

</html>